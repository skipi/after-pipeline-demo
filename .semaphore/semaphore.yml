version: v1.0
name: Semaphore Go CI example
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004
after_pipeline:
  task:
    jobs:
      - name: Test results
        commands:
          - test-results gen-pipeline-report
      - name: Some long running job
        commands:
          - echo I RUN FOR A LONG TIME
          - sleep 60
      - name: Some failure
        commands:
          - echo I FAIL!
          - sleep 10
          - exit 1
blocks:
  - name: Run tests
    task:
      jobs:
        - name: Test
          parallelism: 2
          commands:
            - sleep 10
            - checkout
            - echo Publishing ${SEMAPHORE_JOB_INDEX}/${SEMAPHORE_JOB_COUNT} test
            - test-results publish test/junit-${SEMAPHORE_JOB_INDEX}.xml
        - name: Test failed
          parallelism: 1
          commands:
            - sleep 10
            - checkout
            - echo Publishing ${SEMAPHORE_JOB_INDEX}/${SEMAPHORE_JOB_COUNT} test
            - test-results publish test/junit-failed-${SEMAPHORE_JOB_INDEX}.xml
            - exit 1